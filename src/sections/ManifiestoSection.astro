---
// src/sections/ManifiestoSection.astro
// FOTO STICKER: visible solo en desktop (≥1024px), columna derecha bajo el body text.
// En móvil/tablet la foto aparece en HeroSection.
// Grain + mixed weight (Mejoras 3+4).
---

<section class="manifiesto has-grain" id="manifiesto">
  <div class="manifiesto__inner">

    <p class="section-num" aria-hidden="true">02</p>

    <h2 class="manifiesto__title">
      <span class="manifiesto__title-thin">No diseño webs</span>
      <span class="manifiesto__title-thin">para llenar espacio.</span>
      <em class="manifiesto__title-heavy">Las diseño para que<br>se sientan vivas.</em>
    </h2>

    <!--
      COLUMNA DERECHA: body text + foto sticker (desktop).
      Envueltos en un contenedor para que en el grid de 2 columnas
      ocupen la misma celda y la foto quede naturalmente bajo el texto.
    -->
    <div class="manifiesto__right">

      <div class="manifiesto__body">
        <p>
          Creo páginas que combinan diseño, estructura y código para que
          tu marca se entienda rápido, conecte desde el primer scroll y se
          vea profesional sin perder personalidad.
        </p>
        <p>
          Trabajo especialmente con marcas personales, proyectos creativos
          y negocios del mundo estético que quieren algo más que una
          plantilla bonita.
        </p>
        <p>
          Para mí, una buena web no es solo cómo se ve.<br>
          Es cómo guía, cómo respira y cómo hace que quien entra entienda
          quién eres en segundos.
        </p>
      </div>

      <!--
        FOTO STICKER — solo desktop (≥1024px).
        Oculta en móvil/tablet: aparece en HeroSection.
        Posición: alineada a la derecha del contenedor,
        con una inclinación leve para que tenga personalidad.
      -->
      <div class="manifiesto__photo-wrap" aria-hidden="true">
        <img
          src="/andrea-fusion.png"
          alt="Andrea, diseñadora y desarrolladora web"
          class="manifiesto__photo"
          width="220"
          height="300"
          loading="lazy"
          decoding="async"
        />
      </div>

    </div>

    <blockquote class="manifiesto__quote" id="manifiesto-quote" aria-label="Diseño primero para móvil, porque hoy ahí empieza todo.">
      <span class="manifiesto__quote-bar" aria-hidden="true"></span>
      <span class="manifiesto__quote-text" aria-hidden="true">
        Diseño primero para móvil, porque hoy ahí empieza todo.
      </span>
    </blockquote>

  </div>

  <span class="manifiesto__vertical-word" aria-hidden="true">DISEÑO</span>
  <div class="manifiesto__circle" aria-hidden="true"></div>

</section>

<script>
  const quoteEl = document.querySelector<HTMLElement>('.manifiesto__quote-text');
  if (quoteEl) {
    const text = quoteEl.textContent?.trim() ?? '';
    const words = text.split(' ');

    quoteEl.innerHTML = words
      .map(w => `<span class="q-word">${w}</span>`)
      .join(' ');

    const wordEls = quoteEl.querySelectorAll<HTMLElement>('.q-word');
    const total = wordEls.length;

    const update = () => {
      const section = document.getElementById('manifiesto');
      if (!section) return;
      const rect = section.getBoundingClientRect();
      const vh = window.innerHeight;
      const start = vh * 0.7;
      const end   = vh * 0.2;
      const raw   = (start - rect.top) / (start - end);
      const progress = Math.min(Math.max(raw, 0), 1);
      const activeCount = Math.round(progress * total);
      wordEls.forEach((w, i) => {
        if (i < activeCount) w.classList.add('is-lit');
        else w.classList.remove('is-lit');
      });
    };

    let ticking = false;
    const onScroll = () => {
      if (ticking) return;
      ticking = true;
      requestAnimationFrame(() => { update(); ticking = false; });
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    update();

    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      wordEls.forEach(w => w.classList.add('is-lit'));
    }
  }
</script>

<style>
  .manifiesto {
    position: relative;
    z-index: 11;
    background: var(--color-bg-light);
    border-radius: var(--radius-card) var(--radius-card) 0 0;
    box-shadow: var(--shadow-card);
    overflow: hidden;
    will-change: transform;
    margin-top: 75vh;
  }

  /* z-index: 1 para quedar sobre el grain ::before */
  .manifiesto__inner {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 5rem 1.5rem 5rem;
    display: grid;
    gap: 3rem;
  }

  /* ── TITULAR MIXED WEIGHT ── */
  .manifiesto__title {
    display: flex;
    flex-direction: column;
    font-family: var(--font-display);
    font-size: clamp(2.2rem, 7vw, 5.5rem);
    line-height: 1.0;
    letter-spacing: -0.02em;
    color: var(--color-text-dark);
    gap: 0;
  }

  .manifiesto__title-thin {
    font-weight: 400;
    font-style: normal;
    color: var(--color-text-mid);
    display: block;
  }

  .manifiesto__title-heavy {
    font-weight: 900;
    font-style: italic;
    color: var(--color-text-dark);
    display: block;
    margin-top: 0.05em;
  }

  /* ── Columna derecha (body + foto) ── */
  .manifiesto__right {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  /* ── Cuerpo de texto ── */
  .manifiesto__body {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
    max-width: 60ch;
  }

  .manifiesto__body p {
    font-family: var(--font-body);
    font-size: clamp(1rem, 2.2vw, 1.15rem);
    line-height: 1.75;
    color: var(--color-text-mid);
  }

  /* ── Foto sticker — oculta en móvil ── */
  .manifiesto__photo-wrap {
    display: none; /* oculta hasta desktop */
  }

  .manifiesto__photo {
    width: auto;
    height: clamp(200px, 22vw, 300px);
    object-fit: contain;
    object-position: bottom center;

    /*
      EFECTO STICKER:
      Drop-shadows en 8 direcciones → borde blanco sólido
      que sigue el contorno del PNG transparente.
      Última sombra con blur = sombra de profundidad.
    */
    filter:
      drop-shadow(-4px  0    0 #ffffff)
      drop-shadow( 4px  0    0 #ffffff)
      drop-shadow( 0   -4px  0 #ffffff)
      drop-shadow( 0    4px  0 #ffffff)
      drop-shadow(-3px -3px  0 #ffffff)
      drop-shadow( 3px -3px  0 #ffffff)
      drop-shadow(-3px  3px  0 #ffffff)
      drop-shadow( 3px  3px  0 #ffffff)
      drop-shadow( 0    8px 20px rgba(61, 26, 92, 0.2));

    /* Leve inclinación: personalidad, no rigidez */
    transform: rotate(2deg);
    transform-origin: bottom center;

    transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
  }

  .manifiesto__photo:hover {
    transform: rotate(0deg) scale(1.02);
  }

  /* ── Quote reactiva ── */
  .manifiesto__quote {
    display: flex;
    align-items: flex-start;
    gap: 1.25rem;
    max-width: 42ch;
    line-height: 1.3;
    margin: 0;
  }

  .manifiesto__quote-bar {
    display: block;
    width: 4px;
    min-width: 4px;
    height: 3em;
    background: var(--color-accent-lime);
    border-radius: 99px;
    flex-shrink: 0;
    margin-top: 0.15em;
  }

  .manifiesto__quote-text {
    font-family: var(--font-script);
    font-size: clamp(1.3rem, 3.5vw, 2rem);
    font-style: italic;
    color: var(--color-text-dark);
  }

  :global(.q-word) {
    display: inline-block;
    color: rgba(26, 10, 46, 0.25);
    transition: color 0.3s ease;
  }

  :global(.q-word.is-lit) {
    color: var(--color-text-dark);
  }

  /* ── Palabra vertical (desktop) ── */
  .manifiesto__vertical-word {
    display: none;
    position: absolute;
    left: -2.5rem;
    top: 50%;
    transform: translateY(-50%) rotate(-90deg);
    transform-origin: center center;
    font-family: var(--font-display);
    font-weight: 900;
    font-size: clamp(0.65rem, 1vw, 0.75rem);
    letter-spacing: 0.35em;
    text-transform: uppercase;
    color: var(--color-text-mid);
    opacity: 0.2;
    pointer-events: none;
    user-select: none;
    white-space: nowrap;
    z-index: 1;
  }

  /* ── Círculo decorativo ── */
  .manifiesto__circle {
    position: absolute;
    bottom: -5rem;
    right: -5rem;
    width: clamp(200px, 40vw, 380px);
    height: clamp(200px, 40vw, 380px);
    border-radius: 50%;
    background: radial-gradient(
      circle,
      rgba(200, 241, 53, 0.18) 0%,
      transparent 70%
    );
    pointer-events: none;
    z-index: 0;
  }

  /* ── Desktop: grid 2 columnas ── */
  @media (min-width: 768px) {
    .manifiesto__inner {
      padding: 7rem 4rem 7rem 6rem;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto auto;
      column-gap: 4rem;
    }

    .section-num         { grid-column: 1 / -1; }
    .manifiesto__title   { grid-column: 1; align-self: start; }
    .manifiesto__right   { grid-column: 2; padding-top: 0.5rem; }
    .manifiesto__quote   { grid-column: 1 / -1; }

    .manifiesto__vertical-word {
      display: block;
      left: 1.25rem;
    }
  }

  /* ── Desktop ≥1024px: mostrar foto ── */
  @media (min-width: 1024px) {
    .manifiesto__photo-wrap {
      display: flex;
      justify-content: flex-end; /* la foto se alinea a la derecha del contenedor */
      padding-right: 1rem;
    }

    .manifiesto__vertical-word { left: 1.5rem; }
  }

  /* ── Reduced motion ── */
  @media (prefers-reduced-motion: reduce) {
    .manifiesto__photo {
      transition: none;
      transform: rotate(2deg);
    }
    .manifiesto__photo:hover {
      transform: rotate(2deg);
    }
  }
</style>